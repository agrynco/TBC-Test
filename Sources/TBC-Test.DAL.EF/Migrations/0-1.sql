-- -- Start checking possibility of using
DECLARE @newDbVersion       VARCHAR(11)
SET @newDbVersion = '0.1'

DECLARE @currentDbVersion       VARCHAR(11)
SET @currentDbVersion = dbo.GetCurrentDbVersionAsString()

DECLARE @errorMessage NVARCHAR(500);

IF dbo.CompareDbVersionWithCurrent(@newDbVersion) <> 1
BEGIN
    SET @errorMessage = 'Cannot install script ' + @newDbVersion + '. DB version ' + @currentDbVersion + ' expected.'
    RAISERROR(@errorMessage, 20, -1) WITH LOG
END
GO
-- End checking possibility of using

-- BEGIN CHANGES
CREATE TABLE [dbo].[People] (
    [Id] [int] NOT NULL IDENTITY,
    [Birthdate] [datetime] NOT NULL,
    [FirstName] [nvarchar](max),
    [Gender] [int] NOT NULL,
    [LastName] [nvarchar](max),
    [PersonalNumber] [nvarchar](max),
    [Salary] [decimal](18, 2) NOT NULL,
    [Created] [datetime],
    [Deleted] [datetime],
    [IsDeleted] [bit] NOT NULL,
    [Updated] [datetime],
    CONSTRAINT [PK_dbo.People] PRIMARY KEY ([Id])
)
CREATE TABLE [dbo].[__MigrationHistory] (
    [MigrationId] [nvarchar](150) NOT NULL,
    [ContextKey] [nvarchar](300) NOT NULL,
    [Model] [varbinary](max) NOT NULL,
    [ProductVersion] [nvarchar](32) NOT NULL,
    CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
)
INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201709232100283_migration', N'TBC_Test.DAL.EF.Migrations.Configuration',  0x1F8B0800000000000400CD58CD6EE33610BE17E83B083AB54062E5E79206F22E123B2E8CC689B172F65AD0D2D8214A91AA4805F6B3EDA18FD457E8D092284AF28FEC6417852FF268E6E37038FC6646FF7EFBC7FFBC8A99F306A9A482F7DDCBDE85EB000F4544F9B2EF666A717EE37EFEF4F34FFE4314AF9CAFA5DEB5D6434B2EFBEEAB52C9ADE7C9F01562227B310D5321C542F542117B2412DED5C5C56FDEE5A50708E12296E3F85F32AE680C9B3FF87720780889CA089B8808982CE4F826D8A03A4F2406999010FAEEEC7EF0E70CA4EA0DEF1E7B0F23D7B96394A01B01B085EB10CE85220A9DBC7D9110A854F06590A080B0D93A01D45B1026A170FEB652EFBA8F8B2BBD0FAF322CA1C24C2A111F0978795D04C66B9A9F145ED7040E43F78021566BBDEB4DF8FAEE144F4F033797BA1DB054AB59B1BDCF24E520656F888A94F772D3330715CEB7299C99D4C00CD2BF3367903195A5D0E790A994B033679ACD190DFF80F54CFC05BCCF33C66C7FD1637C5713A0689A8A0452B5FE028B6217E3C875BCBA9DD7343466964DBEC33157D757AEF3848B933903930E5634022552F81D38A4444134254A41CA35066C02DA5ABDB1D63D4DD56B84A6E592437C9E61B26F59753FD288A652E9C71209D319AFA5EB4CC8EA11F852BDF65D7C749D115D41544A0AE8174EF116A3914AB3832BE16E2348CD3278937AA5E8489F1FC90F7239CF48C29EB2786EB9FEBD960B0823E9DA1C29843426CC75A6293E15D479E33A414874A4B625D87EF8410A3AD9DA29B3DF6C080C4E301BCB86E1BD100C083FDAED97243AECB6EF554C54E7A72CB6D8A94CB8B11C31B2AC88FA04B6CAA13E9EAD30651097AD31C56C36A98768023A218B4D4D301F5CE72B6119FEB96C85B3A63B427EA7CC685FB5A398C7ABCDF1583E156ECB20CDE6E170AE85B0525B028885B188A12C92BFEE550E1A80AA5D35E93AD53916245156946DC76D9CAA8AB99757F3B2EA7B3BCABE3F21498231B6DA8042E204790F30380F8EAF8F718EE185724B9934DE9A95B00A902534DEE2D2E8E9869831D9C99CE80C1D44714BAD76043BC25B2E558F72B30256412FF5F57371D0F55EA83C8F064415BF116E29C632B6D91D18474C6BD032DC74609AFAB614D4816059CC7715E57DD65689B4412C71772CAB48DA5896B83B564941365029EB8E5295401BA79276476AD6381BAFF9AE3B6A59CA6CB452D61DC5542C1BC608BBE3984A64E31861771CABA6D512539E8065CA9A8D64846D1CDF6BDCAFE61DF65A97B8D1C03639611F9F3655CCEA86571BFCE9175C7678B66A915BAEA2FB1CF146234D6CC15A2A887B5AA117FCCD068CE27E2B8509E174818C94574D17B9F7A631A1FD7FA6254FCA88751A997EF89842754C0F0E2247766BADC9443FAB0F994CF81B49C35792FE1293D5AF36DCF1D3C766EBEF9C3ADEE5CEF6C9E25D90F5E921FACED3C3B663EDE26563283815A6355DCCE9F127DA982CBAF9B27BD2D8D625B73BB92E6DF09E2E38274B74762ED0EFDCC9298884ED70B34387DC666EDFB3BF9DF94390745941E82F691C424D891568A933E60B518619B7657B54AA344E61028A60E8C95DAAE882840A5F8738466D46EC624C79C04B128DF973A6924CDD4989130DAB3512BEB77FFDCD1850F7D97F4EF43FF9115B4037A9CE9E677E9F511619BF47ED2CDC05A113A5A061F42A509A8E976B83F4247847A0227C434834E3713583386108269F7940DEE014DF70967B842509D76501DE0D72F820EA61F787942C5312CB02A3B2D7DF833DFD41F8D37F1B488E7242160000 , N'6.1.3-40302')


-- END CHANGES

-- Start writing new version info 
GO
IF @@ERROR <> 0
BEGIN
    DECLARE @errorMessage VARCHAR(MAX)
    SET @errorMessage = ERROR_MESSAGE()
    RAISERROR(@errorMessage, 16, 1)
END
ELSE
BEGIN
    DECLARE @newDbVersion       varchar(11)
    SET @newDbVersion = '0.1'
    BEGIN
        EXEC AppendDbVersionInfo @newDbVersion, 'Create table People'
        
        PRINT 'Completed successfully'
    END
END
GO
-- End writing new version info
